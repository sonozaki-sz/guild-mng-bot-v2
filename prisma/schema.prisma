// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

// Guild Configuration
model GuildConfig {
  id        String   @id @default(cuid())
  guildId   String   @unique
  locale    String   @default("ja")

  // 詳細設定（JSON形式で保存）
  afkConfig              String? // JSON: AfkConfig
  vacConfig              String? // JSON: VacConfig
  bumpReminderConfig     String? // JSON: BumpReminderConfig
  stickMessages          String? // JSON: StickMessage[]
  memberLogConfig        String? // JSON: MemberLogConfig

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("guild_configs")
}

// Bump Reminder (Bump通知)
model BumpReminder {
  id          String   @id @default(cuid())
  guildId        String
  channelId      String   // 通知を送信するチャンネル
  messageId      String?  // 元のBumpメッセージID (返信用)
  panelMessageId String?  // Bumpパネルメッセージ ID (リマインダー送信後に削除)
  serviceName    String?  // サービス名 (Disboard, Dissoku)
  scheduledAt    DateTime // 通知予定時刻
  status         String   @default("pending") // pending, sent, cancelled

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([guildId])
  @@index([status, scheduledAt])
  @@map("bump_reminders")
}

// MessageDelete User Setting (message-delete 機能のユーザー個別設定)
model MessageDeleteUserSetting {
  id          String   @id @default(cuid())
  userId      String   @map("user_id")
  guildId     String   @map("guild_id")
  skipConfirm Boolean  @default(false) @map("skip_confirm") // message-delete 確認ダイアログをスキップするか

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@unique([userId, guildId])
  @@index([guildId])
  @@map("message_delete_user_settings")
}

// Sticky Message (スティッキーメッセージ)
model StickyMessage {
  id            String   @id @default(cuid())
  guildId       String   @map("guild_id")
  channelId     String   @unique @map("channel_id")
  content       String
  embedData     String?  @map("embed_data") // JSON文字列
  updatedBy     String?  @map("updated_by") // 最終設定・更新者の Discord ユーザーID
  lastMessageId String?  @map("last_message_id")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  @@index([guildId])
  @@map("sticky_messages")
}
