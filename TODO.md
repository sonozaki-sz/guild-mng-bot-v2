# Guild Management Bot v2 - TODO

> 開発タスク一覧

最終更新: 2026年2月11日

---

## 📊 現在の進捗状況

### ✅ 完了項目

#### 環境構築・インフラ

- [x] プロジェクトセットアップ（pnpm、TypeScript、ESLint、Prettier）
- [x] VSCode開発環境設定（settings、launch、tasks）
- [x] Prismaセットアップとスキーマ定義
- [x] テストインフラ整備（Jest、ユニット/インテグレーションテスト構造）
- [x] i18next多言語対応システム実装
- [x] コマンドローカライゼーション自動生成機能

#### コア機能

- [x] Discord Bot基盤（client.ts、イベントシステム）
- [x] 環境変数管理（Zod validation）
- [x] エラーハンドリング基盤
- [x] データベース接続（Prisma Client）
- [x] Webサーバー基本構造（Fastify）
- [x] ヘルスチェックAPI

#### 実装済みコマンド

- [x] `/ping` - 疎通確認
- [x] `/afk` - AFKチャンネルへのメンバー移動
- [x] `/afk-config` - AFK機能設定

#### 実装済みイベント

- [x] `clientReady` - Bot起動処理
- [x] `interactionCreate` - インタラクション処理

#### テスト

- [x] ユニットテスト基盤整備
- [x] 各種サービス・ユーティリティのテスト

---

## 🚧 進行中・未実装項目

### Phase 1: コア機能の完成

#### 1.1 基本コマンド追加

- [ ] `/help` - ヘルプコマンド（全コマンド一覧）
- [ ] `/server-info` - サーバー情報表示
- [ ] `/user-info` - ユーザー情報表示
- [ ] 各コマンドのテスト

#### 1.3 設定コマンド

- [ ] `/config-locale` - ギルド言語設定
- [ ] `/config-view` - 現在の設定表示
- [ ] `/config-reset` - 設定リセット

**注**: AFK機能はDiscord標準機能があるため、後回し（低優先度に移動）

---

### Phase 2: 主要機能実装

#### 2.1 Bump通知機能

**Bump検知対応サービス:**

- [ ] **Disboard** (`/bump`) - Bot ID: `302050872383242240`
- [ ] **ディス速 (Dissoku)** (`/up`) - Bot ID要確認

**機能実装:**

- [ ] messageCreateイベントでBump検知
  - [ ] Disboard `/bump` コマンド検知
  - [ ] ディス速 `/up` コマンド検知
  - [ ] interactionCommandNameベースの判定
- [ ] タイマー機能（2時間後リマインド）
  - [ ] setIntervalベースのタイマー管理
  - [ ] データベースへの状態永続化
    - [ ] チャンネルID保存
    - [ ] リマインド日時保存
    - [ ] メンション設定保存
  - [ ] Bot再起動時のタイマー復元（重要！）
    - [ ] clientReadyイベントで全ギルドの状態をチェック
    - [ ] 通知時刻を過ぎている場合は即時送信
    - [ ] 未来の場合は残り時間でタイマー再設定
- [ ] リマインダー通知
  - [ ] メンションロール設定
  - [ ] 個別ユーザーメンション（ボタンで通知登録）
  - [ ] 通知メッセージ送信
- [ ] UI/UX
  - [ ] Bumpボタン（通知する/通知しない）
  - [ ] 通知登録・解除機能
  - [ ] ステータス表示
- [ ] 設定コマンド `/bump-reminder-config`
  - [ ] `start` - 機能有効化
  - [ ] `stop` - 機能無効化
  - [ ] `set-mention` - メンションロール設定
  - [ ] `show` - 現在の設定表示
- [ ] 重複防止機構（同時複数Bump対策）
- [ ] テスト実装

#### 2.2 スティッキーメッセージ

- [ ] メッセージ固定コマンド
- [ ] 自動再送信ロジック
- [ ] 管理コマンド（追加/削除/一覧）
- [ ] データベース保存
- [ ] テスト実装

#### 2.3 VAC（ボイスチャンネル自動作成）

**基本機能:**

- [ ] トリガーチャンネル（CreateVC）監視
- [ ] 入室時に専用VCを動的作成
- [ ] 作成者に`ManageChannels`権限付与（Discord標準UIで設定変更可能）
- [ ] 空チャンネル自動削除
- [ ] デフォルト設定（`{ユーザー名}'s Room`）

**操作パネル機能:**

- [ ] 作成されたVCのテキストチャンネルに操作パネル設置
- [ ] パネルからのAFKチャンネル移動（User Select Menu）
- [ ] ボタンUI実装

**コマンド機能:**

- [ ] `/vac-config create-trigger` - トリガーチャンネル作成
- [ ] `/vac-config remove-trigger` - トリガーチャンネル削除
- [ ] `/vac-config show` - 設定表示

**データベース:**

- [ ] VACトリガーチャンネルID保存
- [ ] 作成されたVCリスト管理
- [ ] テスト実装

#### 2.4 メンバー加入・脱退通知

**基本機能:**

- [ ] メンバー参加検知（guildMemberAdd）
- [ ] メンバー退出検知（guildMemberRemove）

**通知機能:**

- [ ] 通知メッセージ送信
- [ ] メンバー情報パネル表示
  - [ ] ユーザー名・ID
  - [ ] アカウント作成日
  - [ ] サーバー参加日
  - [ ] アバター表示
- [ ] Embedフォーマット

**設定機能:**

- [ ] `/join-leave-log-config` - 設定コマンド
  - [ ] `set-channel` - 通知チャンネル設定
  - [ ] `enable` - 機能有効化
  - [ ] `disable` - 機能無効化
  - [ ] `show` - 現在の設定表示

**データベース:**

- [ ] 通知チャンネルID保存
- [ ] 有効/無効フラグ
- [ ] テスト実装

#### 2.5 プロフィールチャンネル

- [ ] プロフィールメッセージ検知
- [ ] メッセージフォーマット検証
- [ ] 設定コマンド `/prof-channel-config`
- [ ] テスト実装

#### 2.6 モデレーション機能

**メッセージ削除コマンド:**

- [ ] `/msg-del` コマンド実装
  - [ ] `user` オプション - 特定ユーザーのメッセージ削除
  - [ ] `count` オプション - 削除件数指定（1-100）
  - [ ] `channel` オプション - 対象チャンネル指定（省略時は実行チャンネル）
- [ ] 権限チェック（MANAGE_MESSAGES権限必須）
- [ ] 削除実行ログ
- [ ] 削除完了通知（一時メッセージ）
- [ ] エラーハンドリング
- [ ] テスト実装

---

### Phase 3: Web UI実装

#### 3.1 認証システム

- [ ] Discord OAuth2統合
- [ ] JWT認証実装
- [ ] セッション管理
- [ ] 権限チェックミドルウェア

#### 3.2 管理API

- [ ] `/api/guilds` - ギルド一覧取得
- [ ] `/api/guilds/:id` - ギルド詳細取得
- [ ] `/api/guilds/:id/config` - 設定取得・更新
- [ ] `/api/guilds/:id/stats` - 統計情報取得
- [ ] バリデーション（Zod）
- [ ] エラーハンドリング

#### 3.3 フロントエンド

- [ ] ダッシュボードUI
- [ ] ギルド設定画面
- [ ] 統計表示画面
- [ ] レスポンシブデザイン
- [ ] 多言語対応

---

### Phase 4: テスト・品質向上

#### 4.1 テストカバレッジ向上

- [ ] インテグレーションテスト拡充
- [ ] E2Eテスト追加
- [ ] カバレッジ目標70%達成
- [ ] エッジケーステスト

#### 4.2 ドキュメント整備

- [ ] API仕様書（OpenAPI/Swagger）
- [ ] コマンドリファレンス
- [ ] デプロイガイド
- [ ] 開発者ガイド
- [ ] 多言語ドキュメント（英語版）

#### 4.3 パフォーマンス最適化

- [ ] データベースクエリ最適化
- [ ] メモリ使用量プロファイリング
- [ ] ログローテーション設定
- [ ] キャッシング戦略

---

### Phase 5: デプロイ・運用

#### 5.1 Docker化

- [ ] 本番用Dockerfile最適化
- [ ] docker-compose.yml改善
- [ ] マルチステージビルド
- [ ] ヘルスチェック設定

#### 5.2 CI/CD

- [ ] GitHub Actions ワークフロー
  - [ ] リント・テスト自動実行
  - [ ] Dockerイメージビルド
  - [ ] 自動デプロイ
- [ ] デプロイスクリプト

#### 5.3 監視・ログ

- [ ] エラー通知（Discord Webhook）
- [ ] ログ集約システム
- [ ] メトリクス収集
- [ ] アラート設定

#### 5.4 バックアップ

- [ ] データベース自動バックアップ
- [ ] 復旧手順ドキュメント
- [ ] バックアップテスト

---

## 🎯 優先度別タスク

### 🔴 高優先度（次の1-2週間）

1. **Bump通知機能** - 人気機能のため優先実装
2. **基本コマンド追加** - ユーザビリティ向上（`/help`、`/server-info` など）
3. **Guild管理API実装** - Web UIからの設定変更
4. **テストカバレッジ向上** - 品質保証

### 🟡 中優先度（1ヶ月以内）

1. **VAC機能** - VC管理の重要機能
2. **Web UI基盤** - 管理インターフェース構築
3. **スティッキーメッセージ** - アナウンス機能
4. **入退出ログ** - モデレーション支援

### 🟢 低優先度（将来的に）

1. **AFK機能の完全実装** - Discord標準機能があるため後回し
   - AFK状態自動検知ロジック
   - チャンネル自動移動機能
   - 復帰検知とステータス解除
2. **高度な統計機能** - アナリティクス
3. **カスタムコマンド** - ギルド別拡張
4. **自動モデレーション** - スパム対策
5. **レベルシステム** - ゲーミフィケーション

---

## 🔧 技術的改善タスク

### コード品質

- [ ] 型安全性の向上（`any`型の削減）
- [ ] ESLintルール厳格化
- [ ] コードコメント充実
- [ ] 未使用コード削除

### アーキテクチャ

- [ ] リポジトリパターン完全実装
- [ ] 依存性注入の導入検討
- [ ] サービス層の整理
- [ ] エラーハンドリング統一

### パフォーマンス

- [ ] データベースインデックス最適化
- [ ] クエリN+1問題の解消
- [ ] キャッシング戦略実装
- [ ] メモリリーク調査

### セキュリティ

- [ ] 依存関係の脆弱性スキャン
- [ ] 入力バリデーション強化
- [ ] レート制限実装
- [ ] セキュリティヘッダー設定

---

## 📝 メモ・検討事項

### 技術スタック変更候補

- **Winston vs Pino**: ロガーパフォーマンス比較
- **Keyv vs Prisma**: データ構造複雑化時の検討
- **Jest vs Vitest**: テスト実行速度改善

### 機能拡張アイデア

- **自動翻訳**: メッセージ自動翻訳機能
- **投票システム**: リアクション投票機能
- **ウェルカムメッセージ**: カスタマイズ可能な歓迎メッセージ
- **ロール管理**: 自動ロール付与システム

---

## 🔗 関連ドキュメント

- [README.md](README.md) - プロジェクト概要
- [docs/DEVELOPMENT_ROADMAP.md](docs/DEVELOPMENT_ROADMAP.md) - 開発ロードマップ
- [docs/TESTING.md](docs/TESTING.md) - テスト方針
- [docs/I18N_GUIDE.md](docs/I18N_GUIDE.md) - 多言語対応ガイド
- [docs/TEST_SUMMARY.md](docs/TEST_SUMMARY.md) - テスト結果サマリー

---

**次のアクション**: Bump通知機能の実装に着手
