# Guild Management Bot v2 - 開発ロードマップ

> 新プロジェクトの開発方針と作業計画

## 📋 プロジェクト概要

guild-mng-bot-v2は、旧プロジェクト（guild-mng-bot）から完全に独立した新規リポジトリです。
旧プロジェクトのコードや設計は参考にせず、クリーンな状態からモダンな設計・技術スタックで再構築します。

### 基本方針

- ✅ **新規開発**: 旧コードの流用は行わない
- ✅ **モダンな技術**: 最新のベストプラクティスを採用
- ✅ **段階的実装**: MVP → 段階的機能追加
- ✅ **品質重視**: テスト・型安全性・保守性を優先

---

## 🎯 開発原則

### 1. アーキテクチャ原則

- **レイヤー分離**: Bot / Web / Shared の明確な責務分離
- **依存性注入**: テスト可能な設計
- **型安全性**: TypeScript の厳格モード + Zod バリデーション
- **エラーハンドリング**: 統一されたエラー処理機構

### 2. コード品質

- **ESLint + Prettier**: 自動フォーマット・リント
- **テストカバレッジ**: 重要ロジックは必ずテスト
- **ドキュメント**: コード内コメント + Markdown ドキュメント
- **レビュー**: 重要な変更はセルフレビュー必須

### 3. 開発フロー

- **ブランチ戦略**: main（安定版）、feature/xxx（開発）
- **コミット規約**: Conventional Commits（feat/fix/chore など）
- **バージョニング**: セマンティックバージョニング

---

## 🛠 技術スタック

### コア技術

- **Node.js**: v22以上
- **TypeScript**: 5.x
- **Discord.js**: 14.x
- **パッケージマネージャー**: pnpm

### ロガー・バリデーション

- **Winston**: ログ管理（ローテーション、レベル制御）
- **Zod**: 環境変数・API検証

### データベース

- **Keyv**: シンプルなKVストア（初期実装）
- **@keyv/sqlite**: SQLiteアダプター
- **Prisma**: 将来的な移行候補（複雑化した場合）

### Web UI

- **Fastify**: 高速Webフレームワーク
- **@fastify/static**: 静的ファイル配信
- **@fastify/cors**: CORS対応

### スケジューラー

- **node-cron**: タイマー処理（Bump通知など）

### 多言語対応

- **@hi18n/core**: Guild別言語切り替え

### テスト

- **Jest**: テストフレームワーク
- **Vitest**: 高速代替案（検討中）

### 開発ツール

- **tsx**: TypeScript実行
- **tsc-watch**: ファイル監視ビルド
- **concurrently**: 複数プロセス同時実行

---

## 📅 開発フェーズ

### Phase 0: 環境構築 ✅

**目標**: 開発環境の完全セットアップ

- [x] リポジトリ作成
- [x] package.json セットアップ
- [x] TypeScript設定
- [x] ESLint・Prettier設定
- [x] VSCode設定（settings/launch/tasks）
- [x] 基本ディレクトリ構造

### Phase 1: 基盤実装 🚧

**目標**: Bot起動とコア機能の実装

**1.1 ロガー・設定**

- [ ] Winston ロガー実装
  - [ ] コンソール出力
  - [ ] ファイル出力（日次ローテーション）
  - [ ] エラーログ分離
- [ ] 環境変数管理（Zod）
  - [ ] バリデーション
  - [ ] 型定義
- [ ] カスタムエラークラス
  - [ ] BaseError
  - [ ] ValidationError, DatabaseError など

**1.2 Discord Bot基盤**

- [ ] BotClient初期化
- [ ] コマンド登録システム
- [ ] イベント登録システム
- [ ] エラーハンドリング統合

**1.3 データベース**

- [ ] Keyv セットアップ
- [ ] GuildConfig Repository実装
- [ ] 基本CRUD操作
- [ ] マイグレーション準備

**成果物**: Bot起動とログ出力、基本設定保存

---

### Phase 2: コマンド実装（MVP）

**目標**: 最小限の機能でBot稼働

**2.1 基本コマンド**

- [ ] `/ping` - 疎通確認
- [ ] `/help` - ヘルプ表示
- [ ] `/info` - サーバー情報表示

**2.2 設定コマンド**

- [ ] `/cnf-locale` - Guild別言語設定
- [ ] `/cnf-afk` - AFK機能設定

**2.3 多言語対応**

- [ ] LocaleManager実装
- [ ] 日本語カタログ
- [ ] 英語カタログ（オプション）

**成果物**: 基本的なコマンドが動作するBot

---

### Phase 3: 主要機能実装

**目標**: 旧Botの主要機能を再実装

**3.1 AFK機能**

- [ ] AFK状態検知
- [ ] チャンネル移動
- [ ] 復帰検知

**3.2 Bump通知**

- [ ] `/bump` 検知
- [ ] node-cron タイマー設定
- [ ] リマインダー送信
- [ ] 重複防止機構

**3.3 スティッキーメッセージ**

- [ ] メッセージ固定
- [ ] 自動再送信
- [ ] 管理コマンド

**3.4 VAC（ボイスチャンネル自動作成）**

- [ ] トリガーチャンネル検知
- [ ] 動的チャンネル作成
- [ ] 削除処理

**成果物**: 旧Botの主要機能が動作

---

### Phase 4: Web UI実装

**目標**: Web管理画面

**4.1 APIサーバー**

- [ ] Fastifyサーバー構築
- [ ] ヘルスチェックAPI
- [ ] 認証ミドルウェア（JWT）

**4.2 Guild管理API**

- [ ] Guild一覧取得
- [ ] Guild設定取得・更新
- [ ] 統計情報取得

**4.3 フロントエンド**

- [ ] 静的HTML/CSS/JS
- [ ] 設定画面UI
- [ ] ダッシュボード

**成果物**: Web経由でBot設定可能

---

### Phase 5: テスト・品質向上

**目標**: 安定性とメンテナンス性の向上

**5.1 テスト整備**

- [ ] ユニットテスト（重要ロジック）
- [ ] 統合テスト（API・DB）
- [ ] E2Eテスト（主要フロー）
- [ ] カバレッジ70%以上

**5.2 ドキュメント整備**

- [ ] API仕様書
- [ ] コマンドリファレンス
- [ ] デプロイガイド

**5.3 パフォーマンス最適化**

- [ ] DB クエリ最適化
- [ ] メモリ使用量監視
- [ ] ログローテーション確認

**成果物**: 本番運用可能な品質

---

### Phase 6: デプロイ・運用

**目標**: 本番環境での安定稼働

**6.1 CI/CD**

- [ ] GitHub Actions ワークフロー
- [ ] Docker イメージビルド
- [ ] 自動デプロイ

**6.2 監視・ログ**

- [ ] エラー通知（Discord Webhook）
- [ ] ログ集約
- [ ] ヘルスチェック

**6.3 バックアップ**

- [ ] DB 自動バックアップ
- [ ] 復旧手順確認

**成果物**: 本番環境稼働中

---

## 🔄 今後の拡張予定

### 将来的な機能追加

- **統計機能**: サーバー活動統計
- **自動モデレーション**: スパム検知など
- **レベルシステム**: ユーザーアクティビティ
- **カスタムコマンド**: Guild別コマンド

### 技術的改善

- **Prismaマイグレーション**: より複雑なデータ構造への対応
- **Redisキャッシュ**: パフォーマンス向上
- **マイクロサービス化**: Bot/Web完全分離

---

## 📊 現在の進捗状況

### 完了項目

- ✅ Phase 0: 環境構築完了
- ✅ package.json・依存関係セットアップ
- ✅ TypeScript・ESLint・Prettier設定
- ✅ VSCode開発環境整備

### 進行中

- 🚧 Phase 1: 基盤実装
  - 🔄 ロガー実装準備中
  - 🔄 Discord Bot基盤設計中

### 未着手

- ⏳ Phase 2: コマンド実装
- ⏳ Phase 3: 主要機能実装
- ⏳ Phase 4: Web UI実装
- ⏳ Phase 5: テスト・品質向上
- ⏳ Phase 6: デプロイ・運用

---

## 🎯 次のアクション

### 最優先タスク

1. **Winston ロガー実装** (`src/shared/utils/logger.ts`)
2. **環境変数管理** (`src/shared/config/env.ts`)
3. **BotClient作成** (`src/bot/client.ts`)
4. **最初のコマンド実装** (`src/bot/commands/ping.ts`)

### 短期目標（1-2週間）

- Bot起動確認
- 基本コマンド動作確認
- データベース接続確認

### 中期目標（1-2ヶ月）

- Phase 2完了（MVPリリース）
- 主要機能実装開始

---

## 📚 参考リソース

- [Discord.js Guide](https://discordjs.guide/)
- [Fastify Documentation](https://www.fastify.io/)
- [Winston Documentation](https://github.com/winstonjs/winston)
- [Zod Documentation](https://zod.dev/)
- [TypeScript Handbook](https://www.typescriptlang.org/docs/)

---

## 🔗 関連ドキュメント

- [README.md](../README.md) - プロジェクト概要
- [MIGRATION_GUIDE.md](../MIGRATION_GUIDE.md) - 旧プロジェクトからの移行（参考）

---

**最終更新**: 2026年2月7日
