# ãƒ†ã‚¹ãƒˆã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

> Testing Guidelines - ãƒ†ã‚¹ãƒˆè¨­è¨ˆã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

æœ€çµ‚æ›´æ–°: 2026å¹´2æœˆ20æ—¥

---

## ğŸ“‹ æ¦‚è¦

### ç›®çš„

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€guild-mng-bot-v2ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ãŠã‘ã‚‹ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®è¨­è¨ˆæ–¹é‡ã€ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã€ãŠã‚ˆã³å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’å®šç¾©ã—ã¾ã™ã€‚Jestã¨ts-jestã‚’ä½¿ç”¨ã—ã¦TypeScriptã‚³ãƒ¼ãƒ‰ã‚’ãƒ†ã‚¹ãƒˆã—ã€å“è³ªã‚’ä¿è¨¼ã—ã€ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã‚’å®‰å…¨ã«è¡Œã†ãŸã‚ã®åŸºæº–ã‚’æä¾›ã—ã¾ã™ã€‚

### å¯¾è±¡èª­è€…

- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é–‹ç™ºè€…
- ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹æ‹…å½“è€…
- æ–°è¦æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹éš›ã®å‚è€ƒè³‡æ–™ã¨ã—ã¦

---

## ğŸ¯ ãƒ†ã‚¹ãƒˆæ–¹é‡

### åŸºæœ¬æ–¹é‡

1. **é‡è¦åº¦ã«åŸºã¥ããƒ†ã‚¹ãƒˆ**
   - ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œã€ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ï¼‰ã¯å¿…ãšãƒ†ã‚¹ãƒˆ
   - UIãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆã‚³ãƒãƒ³ãƒ‰ã€ã‚¤ãƒ™ãƒ³ãƒˆï¼‰ã¯ä¸»è¦ãƒ•ãƒ­ãƒ¼ã‚’ãƒ†ã‚¹ãƒˆ
   - ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã¯å¯èƒ½ãªé™ã‚Šãƒ†ã‚¹ãƒˆ

2. **ãƒ†ã‚¹ãƒˆãƒ”ãƒ©ãƒŸãƒƒãƒ‰**
   - ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ: 70% - å°ã•ãªå˜ä½ã§ç´ æ—©ãå®Ÿè¡Œ
   - çµ±åˆãƒ†ã‚¹ãƒˆ: 25% - ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“ã®é€£æºã‚’æ¤œè¨¼
   - E2Eãƒ†ã‚¹ãƒˆ: 5% - ä¸»è¦ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼ã‚’æ¤œè¨¼

3. **ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºï¼ˆTDDï¼‰ã®æ¨å¥¨**
   - æ–°æ©Ÿèƒ½å®Ÿè£…æ™‚ã¯ã€å¯èƒ½ãªé™ã‚Šãƒ†ã‚¹ãƒˆã‚’å…ˆã«æ›¸ã
   - ãƒã‚°ä¿®æ­£æ™‚ã¯ã€ã¾ãšå†ç¾ãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ã‹ã‚‰ä¿®æ­£

4. **ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™**
   - å…¨ä½“ç›®æ¨™: 70%ä»¥ä¸Šï¼ˆStatements, Branches, Functions, Linesï¼‰
   - ã‚³ã‚¢ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«: 80%ä»¥ä¸Š
   - UIãƒ¬ã‚¤ãƒ¤ãƒ¼: 50%ä»¥ä¸Š

### ãƒ†ã‚¹ãƒˆã®å“è³ªåŸºæº–

- **ç‹¬ç«‹æ€§**: å„ãƒ†ã‚¹ãƒˆã¯ä»–ã®ãƒ†ã‚¹ãƒˆã«ä¾å­˜ã›ãšã€å˜ç‹¬ã§å®Ÿè¡Œå¯èƒ½
- **å†ç¾æ€§**: åŒã˜æ¡ä»¶ã§å¸¸ã«åŒã˜çµæœã‚’è¿”ã™
- **å¯èª­æ€§**: ãƒ†ã‚¹ãƒˆåã¨æ§‹é€ ã‹ã‚‰æ„å›³ãŒæ˜ç¢ºã«ç†è§£ã§ãã‚‹
- **ä¿å®ˆæ€§**: ã‚³ãƒ¼ãƒ‰å¤‰æ›´æ™‚ã«æœ€å°é™ã®ä¿®æ­£ã§å¯¾å¿œã§ãã‚‹
- **é€Ÿåº¦**: å…¨ãƒ†ã‚¹ãƒˆãŒ10ç§’ä»¥å†…ã«å®Œäº†ã™ã‚‹

---

## ğŸ—ï¸ ãƒ†ã‚¹ãƒˆè¨­è¨ˆ

### ãƒ†ã‚¹ãƒˆæ§‹æˆæˆ¦ç•¥

#### 1. AAA ãƒ‘ã‚¿ãƒ¼ãƒ³ã®éµå®ˆ

ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã¯ä»¥ä¸‹ã®3éƒ¨æ§‹æˆã§è¨˜è¿°ï¼š

```typescript
test("should do something", () => {
  // Arrangeï¼ˆæº–å‚™ï¼‰: ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã¨ãƒ¢ãƒƒã‚¯ã®æº–å‚™
  const input = "test";

  // Actï¼ˆå®Ÿè¡Œï¼‰: ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®å®Ÿè¡Œ
  const result = functionUnderTest(input);

  // Assertï¼ˆæ¤œè¨¼ï¼‰: çµæœã®æ¤œè¨¼
  expect(result).toBe("expected");
});
```

#### 2. ãƒ¢ãƒƒã‚¯æˆ¦ç•¥

- **å¤–éƒ¨ä¾å­˜ã®ãƒ¢ãƒƒã‚¯**: Discord APIã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹
- **æ™‚é–“ä¾å­˜ã®ãƒ¢ãƒƒã‚¯**: `Date.now()`, ã‚¿ã‚¤ãƒãƒ¼é–¢æ•°
- **ãƒ­ã‚°å‡ºåŠ›ã®ãƒ¢ãƒƒã‚¯**: ãƒ†ã‚¹ãƒˆä¸­ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ã‚’æŠ‘åˆ¶
- **ç’°å¢ƒå¤‰æ•°ã®ãƒ¢ãƒƒã‚¯**: ãƒ†ã‚¹ãƒˆç”¨ã®è¨­å®šå€¤ã‚’æ³¨å…¥

#### 3. ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç®¡ç†

- **ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã®æ´»ç”¨**: `testHelpers.ts`ã§å…±é€šã®ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
- **Fixture**: è¤‡é›‘ãªãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã¯åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†
- **Factory ãƒ‘ã‚¿ãƒ¼ãƒ³**: ãƒ¢ãƒƒã‚¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿæˆã‚’é–¢æ•°åŒ–

#### 4. ãƒ†ã‚¹ãƒˆå‘½åè¦å‰‡

```typescript
describe("ClassName/FunctionName", () => {
  describe("methodName", () => {
    it("should [æœŸå¾…ã™ã‚‹å‹•ä½œ] when [æ¡ä»¶]", () => {
      // ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
    });

    it("should throw error when [ã‚¨ãƒ©ãƒ¼æ¡ä»¶]", () => {
      // ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹
    });
  });
});
```

### ãƒ†ã‚¹ãƒˆã‚¹ã‚³ãƒ¼ãƒ—

#### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

- **å¯¾è±¡**: å€‹åˆ¥ã®é–¢æ•°ã€ã‚¯ãƒ©ã‚¹ã€ãƒ¡ã‚½ãƒƒãƒ‰
- **ãƒ¢ãƒƒã‚¯**: ã™ã¹ã¦ã®å¤–éƒ¨ä¾å­˜ã‚’ãƒ¢ãƒƒã‚¯åŒ–
- **ç„¦ç‚¹**: ãƒ­ã‚¸ãƒƒã‚¯ã®æ­£ç¢ºæ€§ã€ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

#### çµ±åˆãƒ†ã‚¹ãƒˆ

- **å¯¾è±¡**: è¤‡æ•°ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®é€£æº
- **ãƒ¢ãƒƒã‚¯**: å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã®ã¿ãƒ¢ãƒƒã‚¯åŒ–
- **ç„¦ç‚¹**: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã€ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

#### E2Eãƒ†ã‚¹ãƒˆï¼ˆä»Šå¾Œå®Ÿè£…äºˆå®šï¼‰

- **å¯¾è±¡**: ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼
- **ãƒ¢ãƒƒã‚¯**: æœ€å°é™ï¼ˆDiscord APIã®ã¿ï¼‰
- **ç„¦ç‚¹**: å®Ÿéš›ã®ä½¿ç”¨ã‚·ãƒŠãƒªã‚ªã€çµ±åˆå‹•ä½œ

---

## ï¿½ ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œæ–¹æ³•

```bash
# ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
pnpm test

# ã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œï¼ˆé–‹ç™ºæ™‚æ¨å¥¨ï¼‰
pnpm test:watch

# ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆä»˜ãã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
pnpm test:coverage
```

**å®Ÿè£…æ¸ˆã¿ãƒ†ã‚¹ãƒˆã¨ä»Šå¾Œã®è¨ˆç”»**: [TEST_PROGRESS.md](TEST_PROGRESS.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---

## ğŸ“ ãƒ†ã‚¹ãƒˆã®æ§‹æˆ

```
tests/
â”œâ”€â”€ setup.ts                             # Jest ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®š
â”œâ”€â”€ tsconfig.json                        # ãƒ†ã‚¹ãƒˆç”¨TypeScriptè¨­å®š
â”œâ”€â”€ helpers/
â”‚   â””â”€â”€ testHelpers.ts                  # ãƒ†ã‚¹ãƒˆç”¨ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
â”œâ”€â”€ unit/                               # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ bot/
â”‚   â”‚   â”œâ”€â”€ commands/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.test.ts
â”‚   â”‚   â”‚   â””â”€â”€ ping.test.ts
â”‚   â”‚   â”œâ”€â”€ events/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.test.ts
â”‚   â”‚   â”‚   â””â”€â”€ interactionCreate.test.ts
â”‚   â”‚   â””â”€â”€ handlers/
â”‚   â”‚       â””â”€â”€ index.test.ts
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ env.test.ts
â”‚   â”œâ”€â”€ errors/
â”‚   â”‚   â”œâ”€â”€ CustomErrors.test.ts
â”‚   â”‚   â””â”€â”€ ErrorHandler.test.ts
â”‚   â”œâ”€â”€ features/
â”‚   â”‚   â””â”€â”€ vac/
â”‚   â”‚       â””â”€â”€ config.test.ts
â”‚   â”œâ”€â”€ scheduler/                      # ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã®ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ CooldownManager.test.ts
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ interaction.test.ts
â”‚       â”œâ”€â”€ logger.test.ts
â”‚       â””â”€â”€ messageResponse.test.ts
â”œâ”€â”€ integration/                        # çµ±åˆãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ bot/
â”‚   â”‚   â”œâ”€â”€ command-event.integration.test.ts
â”‚   â”‚   â””â”€â”€ handler-routing.integration.test.ts
â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”œâ”€â”€ GuildConfigRepository.test.ts
â”‚   â”‚   â””â”€â”€ BumpReminderRepository.test.ts
â”‚   â””â”€â”€ scheduler/
â”‚       â””â”€â”€ BumpReminderManager.test.ts
â”œâ”€â”€ logs/                               # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚ã®ãƒ­ã‚°å‡ºåŠ›
â””â”€â”€ e2e/                                # E2Eãƒ†ã‚¹ãƒˆï¼ˆä»Šå¾Œå®Ÿè£…äºˆå®šï¼‰
```

---

## ğŸ› ï¸ ãƒ†ã‚¹ãƒˆãƒ˜ãƒ«ãƒ‘ãƒ¼

`tests/helpers/testHelpers.ts` ã«ã¯ä»¥ä¸‹ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ï¼š

- `createMockUser()` - Discord ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¢ãƒƒã‚¯ä½œæˆ
- `createMockGuild()` - Discord ã‚®ãƒ«ãƒ‰ã®ãƒ¢ãƒƒã‚¯ä½œæˆ
- `createMockMember()` - Discord ãƒ¡ãƒ³ãƒãƒ¼ã®ãƒ¢ãƒƒã‚¯ä½œæˆ
- `createMockTextChannel()` - ãƒ†ã‚­ã‚¹ãƒˆãƒãƒ£ãƒ³ãƒãƒ«ã®ãƒ¢ãƒƒã‚¯ä½œæˆ
- `createMockInteraction()` - ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ¢ãƒƒã‚¯ä½œæˆ
- `wait()` - éåŒæœŸå‡¦ç†ã®å¾…æ©Ÿ
- `generateSnowflake()` - Discord IDç”Ÿæˆ
- `createTestGuildConfig()` - ãƒ†ã‚¹ãƒˆç”¨ã‚®ãƒ«ãƒ‰è¨­å®šä½œæˆ
- `expectError()` - ã‚¨ãƒ©ãƒ¼ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³

---

## âš™ï¸ ãƒ†ã‚¹ãƒˆè¨­å®š

### `jest.config.ts` ã®ä¸»ãªè¨­å®š

- **ãƒ—ãƒªã‚»ãƒƒãƒˆ**: `ts-jest` - TypeScript ã‚µãƒãƒ¼ãƒˆ
- **ãƒ†ã‚¹ãƒˆç’°å¢ƒ**: `node` - Node.js ç’°å¢ƒ
- **ESM ã‚µãƒãƒ¼ãƒˆ**: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è§£æ±ºã®è¨­å®š
- **ã‚«ãƒãƒ¬ãƒƒã‚¸ã—ãã„å€¤**: 70%ï¼ˆå…¨ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼‰
- **ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«**: `tests/setup.ts`
- **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ**: 10ç§’ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰

### ç’°å¢ƒè¨­å®š

- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹: ãƒ¡ãƒ¢ãƒªä¸Šã§å®Ÿè¡Œï¼ˆ`file::memory:?cache=shared`ï¼‰
- ç’°å¢ƒå¤‰æ•°: `tests/setup.ts` ã§è¨­å®š
- ãƒ­ã‚°å‡ºåŠ›: ãƒ†ã‚¹ãƒˆä¸­ã¯æŠ‘åˆ¶ï¼ˆã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®ã¿è¡¨ç¤ºï¼‰

---

## ğŸ­ ãƒ¢ãƒƒã‚¯ã¨ã‚¹ã‚¿ãƒ–

ä¸»è¦ãªå¤–éƒ¨ä¾å­˜é–¢ä¿‚ã¯ãƒ¢ãƒƒã‚¯åŒ–ã•ã‚Œã¦ã„ã¾ã™ï¼š

- **Winston (Logger)** - ãƒ­ã‚°å‡ºåŠ›ã‚’ãƒ¢ãƒƒã‚¯ã€ãƒ†ã‚¹ãƒˆä¸­ã®å‡ºåŠ›ã‚’æŠ‘åˆ¶
- **Prisma Client** - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œã‚’ãƒ¢ãƒƒã‚¯ã€ãƒ¡ãƒ¢ãƒªDBã‚’ä½¿ç”¨
- **i18next** - ç¿»è¨³æ©Ÿèƒ½ã‚’ãƒ¢ãƒƒã‚¯ã€ç°¡æ˜“çš„ãªç¿»è¨³ã‚’è¿”ã™
- **Discord.js** - Discord APIå‘¼ã³å‡ºã—ã‚’ãƒ¢ãƒƒã‚¯ã€ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã§ç”Ÿæˆ

---

## ğŸ“‹ ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

1. **ãƒ†ã‚¹ãƒˆåˆ†é›¢**
   - å„ãƒ†ã‚¹ãƒˆã¯ç‹¬ç«‹ã—ã¦å®Ÿè¡Œå¯èƒ½
   - `beforeEach` ã§åˆæœŸåŒ–ã€`afterEach` ã§ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
   - ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ã¸ã®ä¾å­˜ã‚’é¿ã‘ã‚‹

2. **ãƒ¢ãƒƒã‚¯ç®¡ç†**
   - ãƒ¢ãƒƒã‚¯ã¯å¿…è¦æœ€å°é™ã«
   - `jest.clearAllMocks()` ã§å„ãƒ†ã‚¹ãƒˆå¾Œã«ã‚¯ãƒªã‚¢
   - ã‚¹ãƒ‘ã‚¤é–¢æ•°ã§å‘¼ã³å‡ºã—ã‚’æ¤œè¨¼

3. **å‹å®‰å…¨æ€§**
   - TypeScript ã®å‹ãƒã‚§ãƒƒã‚¯ã‚’æ´»ç”¨
   - `as any` ã®ä½¿ç”¨ã¯æœ€å°é™ã«
   - ãƒ¢ãƒƒã‚¯ã«ã‚‚é©åˆ‡ãªå‹ã‚’ä»˜ã‘ã‚‹

4. **å¯èª­æ€§**
   - ã‚ã‹ã‚Šã‚„ã™ã„ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å
   - AAA ãƒ‘ã‚¿ãƒ¼ãƒ³ã®éµå®ˆ
   - é–¢æ•°å˜ä½ãƒ»å‡¦ç†ãƒ–ãƒ­ãƒƒã‚¯å˜ä½ã§ã€Œæ„å›³ã€ã‚’çŸ­ã„æ—¥æœ¬èªã‚³ãƒ¡ãƒ³ãƒˆã§æ˜ç¤º

5. **ä¿å®ˆæ€§**
   - ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã®æ´»ç”¨ã§é‡è¤‡ã‚’å‰Šæ¸›
   - ãƒ†ã‚¹ãƒˆã®æ§‹é€ ã‚’çµ±ä¸€
   - å¤‰æ›´ã«å¼·ã„è¨­è¨ˆ

---

## ğŸ“ ãƒ†ã‚¹ãƒˆã‚³ãƒ¡ãƒ³ãƒˆè¦ç´„ï¼ˆ2026å¹´2æœˆ20æ—¥ è¿½åŠ ï¼‰

ãƒ†ã‚¹ãƒˆã®æ„å›³ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚ã«å³åº§ã«æŠŠæ¡ã§ãã‚‹ã‚ˆã†ã€ä»¥ä¸‹ã‚’å¿…é ˆã¨ã—ã¾ã™ã€‚

1. **é–¢æ•°å˜ä½ã‚³ãƒ¡ãƒ³ãƒˆ**
   - `describe` ã”ã¨ã«ã€Œä½•ã‚’æ¤œè¨¼ã™ã‚‹ã¾ã¨ã¾ã‚Šã‹ã€ã‚’1è¡Œã§è¨˜è¿°
   - ä¾‹: `// èªè¨¼ãƒ˜ãƒƒãƒ€ãƒ¼æ¤œè¨¼ã¨ãƒˆãƒ¼ã‚¯ãƒ³ä¸€è‡´åˆ¤å®šã®åˆ†å²ã‚’æ¤œè¨¼`

2. **å‡¦ç†ãƒ–ãƒ­ãƒƒã‚¯å˜ä½ã‚³ãƒ¡ãƒ³ãƒˆ**
   - `beforeEach`/`afterEach`/åˆ†å²ã®å‰ã«ã€Œãªãœãã®æº–å‚™ãƒ»æ¤œè¨¼ã‚’ã™ã‚‹ã‹ã€ã‚’è¨˜è¿°
   - ä¾‹: `// æœŸé™è¶…éåˆ†ã¯å¾©å…ƒæ™‚ã«å³æ™‚å®Ÿè¡Œã•ã‚Œã‚‹`

3. **è¨˜è¿°ãƒ«ãƒ¼ãƒ«**
   - æ—¥æœ¬èªã§ç°¡æ½”ã«ï¼ˆ1ã€œ2è¡Œï¼‰
   - å®Ÿè£…è©³ç´°ã®èª¬æ˜ã§ã¯ãªãã€ãƒ†ã‚¹ãƒˆæ„å›³ãƒ»å‰æãƒ»æœŸå¾…çµæœã‚’æ›¸ã
   - è‡ªæ˜ãª1è¡Œå‡¦ç†ã®é€èªèª¬æ˜ã¯é¿ã‘ã‚‹

---

## ğŸ” ãƒ†ã‚¹ãƒˆè¨­è¨ˆãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆ2026å¹´2æœˆ20æ—¥ï¼‰

### ç¾çŠ¶è©•ä¾¡

- âœ… ãƒ†ã‚¹ãƒˆã¯å…¨ä»¶æˆåŠŸï¼ˆ13 suite / 178 testsï¼‰
- âœ… ãƒ¦ãƒ‹ãƒƒãƒˆãƒ»çµ±åˆï¼ˆãƒ¢ãƒƒã‚¯ä¸­å¿ƒï¼‰ã§ä¸»è¦ãƒ­ã‚¸ãƒƒã‚¯ã®å›å¸°æ¤œçŸ¥ã¯å¯èƒ½
- âš ï¸ ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚«ãƒãƒ¬ãƒƒã‚¸ã—ãã„å€¤ï¼ˆ70%ï¼‰ã¯æœªé”ï¼ˆlines 39.03%, functions 36.66%ï¼‰

### è¨­è¨ˆä¸Šã®ä¸»ãªèª²é¡Œ

1. **å®Ÿæ™‚é–“å¾…ã¡ã«ã‚ˆã‚‹ãƒ•ãƒ¬ãƒ¼ã‚¯/é…å»¶ãƒªã‚¹ã‚¯**
   - å¯¾è±¡: `tests/unit/services/cooldownManager.test.ts`
   - çŠ¶æ³: âœ… å¯¾å¿œæ¸ˆã¿ï¼ˆfake timers ã¸ç§»è¡Œï¼‰
   - è£œè¶³: å®Ÿæ™‚é–“å¾…æ©Ÿã‚’æ’é™¤ã—ã€å†ç¾æ€§ã¨å®Ÿè¡Œé€Ÿåº¦ã‚’æ”¹å–„

2. **ã€Œçµ±åˆãƒ†ã‚¹ãƒˆã€ã®ãƒ¢ãƒƒã‚¯æ¯”ç‡ãŒé«˜ã„**
   - å¯¾è±¡: `tests/integration/database/*.test.ts`, `tests/integration/scheduler/*.test.ts`
   - å¤–éƒ¨ä¾å­˜ã‚’åºƒããƒ¢ãƒƒã‚¯ã—ã¦ãŠã‚Šã€å®Ÿæ…‹ã¯ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆå¯„ã‚Š
   - å¯¾å¿œ: å®ŸDBï¼ˆSQLite in-memoryï¼‰ã‚’ä½¿ã†ç‹­ã„æœ¬çµ±åˆãƒ†ã‚¹ãƒˆã‚’åˆ¥ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§è¿½åŠ 

3. **ã‚°ãƒ­ãƒ¼ãƒãƒ«å‰¯ä½œç”¨ã®ç®¡ç†å¼·åŒ–ä½™åœ°**
   - å¯¾è±¡: `tests/setup.ts`, `tests/unit/config/env.test.ts`
   - `global.console` ã‚„ `process.env` ã®æ“ä½œãŒã‚ã‚Šã€æ‹¡å¼µæ™‚ã«æ±šæŸ“ãƒªã‚¹ã‚¯ãŒã‚ã‚‹
   - çŠ¶æ³: âœ… `env.test.ts` ã¯ã‚­ãƒ¼å˜ä½å¾©å…ƒã¸ç§»è¡Œæ¸ˆã¿
   - å¯¾å¿œ: å¤‰æ›´ãƒ»å¾©å…ƒãƒãƒªã‚·ãƒ¼ã‚’æ˜ç¤ºã—ã€å¿…è¦ç®‡æ‰€ã§ã¯ `beforeEach/afterEach` ã§å±€æ‰€åŒ–

4. **ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã®å®‰å…¨æ€§æ”¹å–„ä½™åœ°**
   - å¯¾è±¡: `tests/helpers/testHelpers.ts` ã® `expectError`
   - çŠ¶æ³: âœ… å¯¾å¿œæ¸ˆã¿ï¼ˆå˜ä¸€å®Ÿè¡Œã§å‹ãƒ»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ¤œè¨¼ï¼‰
   - è£œè¶³: å‰¯ä½œç”¨ã‚’æŒã¤é–¢æ•°ã§ã‚‚æ¤œè¨¼çµæœãŒå®‰å®š

### å„ªå…ˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆæ¨å¥¨ï¼‰

1. æœ¬çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆå®ŸDBä½¿ç”¨ï¼‰ã‚’æœ€å°ã‚±ãƒ¼ã‚¹ã‹ã‚‰è¿½åŠ 
2. ä½ã‚«ãƒãƒ¬ãƒƒã‚¸é ˜åŸŸï¼ˆã‚³ãƒãƒ³ãƒ‰ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆãƒ»Webãƒ«ãƒ¼ãƒˆï¼‰ã¸é‡ç‚¹çš„ã«ãƒ†ã‚¹ãƒˆè¿½åŠ 
3. `process.env` å¤‰æ›´ãƒ†ã‚¹ãƒˆã®å…±é€šãƒ˜ãƒ«ãƒ‘ãƒ¼åŒ–ï¼ˆã‚­ãƒ¼å˜ä½å¾©å…ƒã®æ¨ªå±•é–‹ï¼‰

### process.env ã®å®‰å…¨ãªå–ã‚Šæ‰±ã„ï¼ˆå¿…é ˆï¼‰

`process.env` ã‚’ãƒ†ã‚¹ãƒˆå†…ã§æ‰±ã†å ´åˆã€**ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå†ä»£å…¥ã‚’é¿ã‘ã¦ã‚­ãƒ¼å˜ä½ã§å¾©å…ƒ**ã™ã‚‹ã€‚

```typescript
const originalEnv = { ...process.env };

const restoreEnv = () => {
  for (const key of Object.keys(process.env)) {
    if (!(key in originalEnv)) delete process.env[key];
  }
  for (const [key, value] of Object.entries(originalEnv)) {
    process.env[key] = value;
  }
};

beforeEach(() => restoreEnv());
afterEach(() => restoreEnv());
```

ç†ç”±:

- `process.env = {...}` ã®å†ä»£å…¥ã¯å‚ç…§å…±æœ‰ä¸­ã®å‰¯ä½œç”¨ã‚’æ‹›ãã‚„ã™ã„
- ã‚­ãƒ¼å˜ä½å¾©å…ƒã¯ä»–ãƒ†ã‚¹ãƒˆã¸ã®æ±šæŸ“ã‚’æœ€å°åŒ–ã§ãã‚‹

---

## âš ï¸ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã¯10ç§’ã«è¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚éåŒæœŸå‡¦ç†ãŒé•·ã„å ´åˆã¯èª¿æ•´ã—ã¦ãã ã•ã„ï¼š

```typescript
test("long running test", async () => {
  // ...
}, 30000); // 30ç§’ã«å»¶é•·
```

### Worker process warning

CooldownManagerã®å®šæœŸã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã«ã‚ˆã‚‹è­¦å‘Šã§ã™ã€‚ãƒ†ã‚¹ãƒˆã¯æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™ã€‚

```
A worker process has failed to exit gracefully...
```

### ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è§£æ±ºã‚¨ãƒ©ãƒ¼

`jest.config.ts` ã® `moduleNameMapper` ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

```typescript
moduleNameMapper: {
  '^@/(.*)$': '<rootDir>/src/$1',
}
```

### Prisma Client ã‚¨ãƒ©ãƒ¼

ãƒ†ã‚¹ãƒˆå‰ã« Prisma Client ãŒç”Ÿæˆã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªï¼š

```bash
pnpm db:generate
```

---

## ğŸ“ˆ ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆ

ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã¯ `coverage/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç”Ÿæˆã•ã‚Œã¾ã™ï¼š

```bash
# ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ãã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pnpm test:coverage

# HTMLãƒ¬ãƒãƒ¼ãƒˆã‚’é–‹ã
open coverage/lcov-report/index.html
```

ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã§ç¢ºèªã§ãã‚‹æƒ…å ±ï¼š

- ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆ ã‚«ãƒãƒ¬ãƒƒã‚¸
- ãƒ–ãƒ©ãƒ³ãƒ ã‚«ãƒãƒ¬ãƒƒã‚¸
- é–¢æ•° ã‚«ãƒãƒ¬ãƒƒã‚¸
- ãƒ©ã‚¤ãƒ³ ã‚«ãƒãƒ¬ãƒƒã‚¸
- æœªã‚«ãƒãƒ¼ã®è¡Œã®è©³ç´°

---

## ğŸ“ å‚è€ƒãƒªã‚½ãƒ¼ã‚¹

- [Jest Documentation](https://jestjs.io/)
- [ts-jest Documentation](https://kulshekhar.github.io/ts-jest/)
- [Testing Best Practices](https://github.com/goldbergyoni/javascript-testing-best-practices)

---

## ï¿½ é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [TEST_PROGRESS.md](TEST_PROGRESS.md): ãƒ†ã‚¹ãƒˆå®Ÿè£…é€²æ—ã¨ä»Šå¾Œã®è¨ˆç”»
- [TODO.md](../TODO.md): é–‹ç™ºã‚¿ã‚¹ã‚¯ä¸€è¦§
- [README.md](../README.md): ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
